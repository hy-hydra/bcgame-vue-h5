!function(t,i){"use strict";const e=.5*Math.PI,s=2*Math.PI;i.Graphics.curves.minSegments=32;class h extends i.utils.EventEmitter{constructor({app:t,game:e}){super(),this.name="",this.game=e,this.retime=0,this.config={left:40,right:20,top:60,bottom:40,countdown:3,speed:.02,speedScale:.02,accSpeed:5e-4,accScale:1e-4,bvScale:.3,bv:0,bva:5e-4,startColor:3916055,startLineWidth:4,startArcSize:35,startSize:16,rulerColor:7829367,rulerWidth:1,rulerFSize:10,gmFSize:42,gmTextColor:16777215,listY:20,listSpeed:.5,listColor:16777215,listSize:10,endColor:15557376,endColor2:3026996,endSize:25,gmvalue:1,gmLineWidth:6,dou:10,douWidth:2,pointSize:6,bgColor:1513755,textLen:20},this.startAngle=0,this.endAngle=-1e-4,this.app=t,this.container=new i.Container,this.startContainer=new i.Container,this.endContainer=new i.Container,this.startContainer.zIndex=20,this.container.addChild(this.startContainer),this.container.addChild(this.endContainer);const s=this.filter=new i.ColorMatrixFilter;this.filterContainer=new i.Container,this.filterContainer.zIndex=10,this.filterContainer.filters=[s],this.container.addChild(this.filterContainer),this.gmPoints=[new i.Point,new i.Point,new i.Point,new i.Point],this.paused=!1,this.started=!1,this.startStatus=!1,this.width=this.height=0,this.vw=this.vh=1,this.speed=1,this.accSpeed=.1,this.speedScale=.1,this.bv=0,this.bva=0,this.gmvalue=1,this.gameTime=0,this.mstime=0,this.countdown=0,this.debugMsg="2.2x",this.rulerXs=[],this.rulerYs=[],this.textList=[],this.linetexture=null,this.bgtexture=null,this.dou=0,this.ykeSet=[.2,2,10,50,100,200],this.x_value2=0,this.x_value=.2,this.y_value=.2,this.y_offset=0,this.x_offset=0,this.xkeSet=[2,10,50,100],this.inited=!1,this.ended=!1,this.endValue=9999}async init(){console.log("init1"),await i.Assets.load("./lan.fnt"),this.bg=new i.Graphics,this.rulerLine=new i.Graphics,this.container.addChild(this.bg),this.container.addChild(this.rulerLine),this.startLine=new i.Graphics,this.startArc=new i.Graphics,this.startContainer.addChild(this.startArc),this.startText=new i.BitmapText("starts in",{align:"center",fontName:"lan",fontSize:this.config.startSize,tint:this.config.startColor}),this.startText.anchor.set(.5),this.startContainer.addChild(this.startText),this.startTime=new i.BitmapText("5.8s",{align:"center",fontName:"lan",fontSize:.7*this.config.startArcSize,tint:this.config.startColor}),this.startTime.anchor.set(.5),this.startContainer.addChild(this.startTime),this.initRuler(),this.initGame();for(let t=0,e=this.config.textLen;t<e;t++){let t=new i.BitmapText("aa@bb",{fontName:"lan",fontSize:this.config.listSize,tint:this.config.listColor});t.anchor.set(1,.5),t.gvalue=1,t.zIndex=11,t.gname="aa",t.visible=!1,this.container.addChild(t),this.textList.push(t)}this.endText=new i.BitmapText("1.34x",{align:"center",fontName:"lan",fontSize:this.config.endSize,tint:this.config.endColor}),this.endText.anchor.set(.5,.5);const{endSize:t,endColor2:e}=this.config;this.endRect=new i.Graphics,this.endRect.beginFill(e),this.endRect.drawRect(0,0,5*t,1.2*t),this.endRect.endFill(),this.container.addChild(this.endRect),this.endText2=new i.BitmapText("crashed",{align:"center",fontName:"lan",fontSize:.7*this.config.endSize,tint:this.config.endColor}),this.endText2.anchor.set(.5,.5),this.container.addChild(this.endText),this.container.addChild(this.endText2),this.container.sortChildren()}resize(){this.reset()}reset(){const{top:t,bottom:i,left:s,right:h,rulerColor:a,rulerWidth:o,gmLineWidth:r,startColor:l,startArcSize:d,startLineWidth:c,startSize:g}=this.config,{rulerLine:u,app:m,startArc:x,gmPoints:f}=this;this.width&&this.height||(this.width=m.screen.width,this.height=.618*m.screen.width),this.vw=this.width-s-h,this.vh=this.height-t-i,f[0].set(s,this.height-i),f[1].copyFrom(f[0]),f[2].copyFrom(f[0]),f[3].copyFrom(f[0]),this.bg.clear(),this.bg.beginFill(this.config.bgColor),this.bg.drawRect(0,0,this.width,this.height),this.bg.endFill();const v=s,p=this.width-h,S=t,b=this.height-i;u.clear(),u.lineStyle(o,a),u.moveTo(v,S),u.lineTo(v,b+o),u.lineTo(p,b+o);const w=v+.5*this.vw,C=S+.5*this.vh;this.startAngle=0,x.position.x=w,x.position.y=C-g,this.gmtext.position.set(w,C),this.startText.position.set(w,C+d),this.startTime.position.set(w,x.position.y);const y=S+.25*this.vh,T=S+.5*this.vh;this.endText.position.set(w,y),this.endText2.position.set(w,T),this.endRect.position.set(w-.5*this.endRect.width,T-.5*this.endRect.height);const z=this.endAngle-e,F=this.startAngle-e;x.clear(),x.lineStyle(c,l,1),x.arc(0,0,d,F,z),x.endFill(),this.speed=this.config.speed,this.speedScale=this.config.speedScale,this.accSpeed=this.config.accSpeed,this.countdown=this.config.countdown,this.countdown=this.config.countdown,this.startTime.text=this.countdown.toFixed(1)+"s",this.startContainer.visible=!0,this.paused=!1,this.started=!1,this.startStatus=!0,this.ended=!1,this.ended=!1,this.endValue=1e3,this.endRect.visible=this.endText.visible=this.endText2.visible=!1,this.bva=this.config.bva,this.bv=this.config.bv,this.gmvalue=this.config.gmvalue,this.gmtext.text=this.gmvalue.toFixed(2)+"x",this.linetexture||(this.linetexture=n("#fff","#6a28f5",this.width,this.height,.3,.7)),this.bgtexture||(this.bgtexture=n("#30264c","#5833ac",this.width,this.height,.3,.7)),this.y_offset=1,this.gameTime=0,this.mstime=0,this.gmtext.visible=!1,this.gameBg.visible=!1,this.gameLine.visible=!1,this.gamePoint.visible=!1;for(let t of this.textList)t.visible=!1;this.resetKy(),this.resetKx(),this.updateRuler(1),this.updateGame(1)}startGame(){this.gmtext.visible=this.gameBg.visible=this.gameLine.visible=this.gamePoint.visible=!0,this.startStatus=!1,this.startContainer.visible=!1}updateText(t){const{listSpeed:i,listSize:e,bottom:s}=this.config,h=this.height-s+e;this.textList.forEach((e=>{if(!e.visible)return;let s=i*t;e.y+=s,e.x-=s,e.alpha-=.008*t,(e.y>h||e.alpha<0)&&(e.visible=!1,e.alpha=1)}))}setText(t,i){if(this.paused||this.startStatus||!this.started)return;const{gmPoints:e}=this;i=Number(i);for(let s of this.textList)if(!s.visible){s.y=e[3].y+this.config.listY,s.x=e[3].x,s.visible=!0,s.text=`${t}@${i.toFixed(2)}`,s.gvalue=i;break}}setEnd(){this.ended=!0,this.endText.text=this.gmvalue.toFixed(2)+"x",this.endRect.visible=this.endText.visible=this.endText2.visible=!0,this.gmtext.visible=!1,"function"==typeof this.onend&&this.onend(),this.retime>0&&setTimeout((t=>{this.reset()}),this.retime)}end(t){!t||t<this.gmvalue?this.endValue=this.gmvalue:this.endValue=t}updateStart(t){if(this.countdown-=this.app.ticker.deltaMS/1e3,this.countdown<=0)return void this.startGame();this.startTime.text=this.countdown.toFixed(1)+"s",this.startAngle=s*((this.config.countdown-this.countdown)/this.config.countdown);const i=this.endAngle-e,h=this.startAngle-e,n=this.startArc,{startArcSize:a,startLineWidth:o,startColor:r}=this.config;n.clear(),n.lineStyle(o,r,1),n.arc(0,0,a,h,i),n.endFill()}start(t){if(this.started=!0,t&&"number"==typeof t&&t>this.config.gmvalue){for(this.startStatus=!1;this.update(1),!(this.gmvalue>=t););this.startGame(),this.paused=!1}else this.paused=!1,this.startStatus=!0}updateGame(t){let{bv:i,vh:e,vw:s,gmPoints:h,gmtext:n,gmvalue:a,gamePoint:o,gameBg:r,height:l,gameLine:d}=this,{top:c,left:g,bottom:u,gmLineWidth:m,dou:x,douWidth:f,pointSize:v}=this.config;this.dou<0&&Math.random()<.3&&(this.dou=x),this.dou--,n.text=a.toFixed(2)+"x";let p={x:this.vw,y:this.vh};i<.2&&(p.x=s*i*5,p.y=e*i*5),this.x_value2=p.x,f=i<.2?0:(Math.random()+.5)*f,this.dou>0&&(p.x-=f,p.y-=f),h[1].x=g+p.x*(.3+.7*i),h[1].y=l-u-(.3*p.y-i*p.y*.3),h[2].x=g+p.x*(.7+.3*this.bv),h[2].y=l-u-(.7*p.y-this.bv*p.y*.7),h[3].x=g+p.x,h[3].y=l-u-p.y,d.clear(),d.lineTextureStyle({width:m,texture:this.linetexture}),d.moveTo(h[0].x,h[0].y),d.bezierCurveTo(h[1].x,h[1].y,h[2].x,h[2].y,h[3].x,h[3].y),r.clear(),r.beginTextureFill({texture:this.bgtexture}),r.moveTo(h[0].x,h[0].y),r.bezierCurveTo(h[1].x,h[1].y,h[2].x,h[2].y,h[3].x,h[3].y),r.lineTo(h[3].x,h[0].y),r.closePath(),r.endFill(),o.clear(),o.beginTextureFill({texture:this.linetexture}),o.drawCircle(h[3].x,h[3].y,v),o.endFill(),this.updateRuler(t)}update(t){if(!this.started)return;if(this.startStatus)return void this.updateStart(t);if(this.updateText(t),this.ended)return;let{speed:i,accSpeed:e,speedScale:s}=this;this.speed=i+e,this.accSpeed=e+e*this.config.accScale,this.gmvalue=this.gmvalue+t*s*i,this.gameTime+=this.app.ticker.deltaMS,this.mstime<10&&(this.gameTime=1.001*this.gameTime),this.mstime=this.gameTime/1e3,this.updateLine(t),this.updateGame(t),this.gmvalue>=this.endValue&&(this.gmvalue=this.endValue,this.setEnd())}updateLine(t){let i=1-this.bv;this.bv>.25&&(i*=this.config.bvScale),this.bv+=i*this.bva*t}tick(t){this.paused||this.update(t)}async mount(){this.resize(),this.app.ticker.add(this.tick,this)}unmount(){this.app.ticker.remove(this.tick,this)}destroy(){this.unmount(),this.container.destroy(),this.container=null,this.app=null}initGame(){const t=this.container;this.config.left,this.config.top;this.vw,this.vh,this.gmtext=new i.BitmapText(this.debugMsg,{align:"center",fontName:"lan",fontSize:this.config.gmFSize,tint:this.config.gmTextColor}),this.gmtext.anchor.set(.5,1),this.gmtext.zIndex=10,this.gameLine=new i.Graphics,this.gameBg=new i.Graphics,this.gamePoint=new i.Graphics,t.addChild(this.gmtext),t.addChild(this.gameBg),t.addChild(this.gameLine),t.addChild(this.gamePoint)}initRuler(){const t=this.container;for(let e=0,s=5;e<s;e++){let e=new i.BitmapText(this.debugMsg,{align:"right",fontName:"lan",fontSize:this.config.rulerFSize,tint:this.config.rulerColor});e.kvalue=2,e.zIndex=11,e.anchor.set(.5),t.addChild(e),this.rulerXs.push(e)}let e=this.text0=new i.BitmapText("0",{align:"right",fontName:"lan",fontSize:this.config.rulerFSize,tint:this.config.rulerColor});e.kvalue=2,e.zIndex=11,e.anchor.set(.5),t.addChild(e);for(let e=0,s=5;e<s;e++){let e=new i.BitmapText(this.debugMsg,{align:"right",fontName:"lan",fontSize:this.config.rulerFSize,tint:this.config.rulerColor});e.kvalue=1,e.zIndex=11,e.anchor.set(.5),t.addChild(e),this.rulerYs.push(e)}for(let e=0,s=this.config.textLen;e<s;e++){let e=new i.BitmapText(this.debugMsg,{align:"right",fontName:"lan",fontSize:this.config.rulerFSize,tint:this.config.rulerColor});e.gvalue=1,e.zIndex=11,e.gname="aa",e.visible=!1,t.addChild(e),this.textList.push(e)}}resetKy(){let{rulerFSize:t,left:i}=this.config,{gmvalue:e,y_offset:s,y_value:h}=this,n=null;const a=e;for(let t of this.ykeSet)if(5*t+s>a){n=t;break}n||(n=this.ykeSet[this.ykeSet.length-1]),this.y_value=n,this.rulerYs.forEach(((e,h)=>{let a=(h+1)*n+(n<1?s:0);e.kvalue=a,e.x=i-1.6*t,e.text=Number(a.toFixed(2))+"x"}))}updateRuler(){let{left:t,rulerFSize:i,top:e,bottom:s}=this.config,{gmvalue:h,x_value:n,x_value2:a,y_offset:o,y_value:r,height:l,gameTime:d,mstime:c,vh:g,vw:u}=this;const m=h,x=5*r;if(x+o<m)return this.resetKy();const f=l-s;let v=x/m*g;r>1?this.rulerYs.forEach(((t,i)=>{let s=f-t.kvalue/x*v;t.visible=s>e,t.y=s})):this.rulerYs.forEach(((t,i)=>{let s=f-t.kvalue/x*g+g;t.y=s,s>e&&(t.visible=!0)}));const p=5*n,S=t;if(c>p)return this.resetKx();let b=0;b=c<10?u:p/c*u;const w=S+u;this.rulerXs.forEach(((t,i)=>{let e=S+t.kvalue/p*b;t.x=e,e<w&&(t.visible=!0)}))}resetKx(){let{rulerFSize:t,top:i,left:e}=this.config,{vw:s,vh:h,mstime:n}=this;let a=null;for(let t of this.xkeSet)if(n<5*t){a=t;break}a||(a=this.xkeSet[this.xkeSet.length-1]),this.x_value=a,this.rulerXs.forEach(((e,s)=>{e.visible=!1;let n=(s+1)*a;e.kvalue=n,e.y=i+h+1.6*t,e.text=n+.5|0})),this.text0.x=e,this.text0.y=i+h+1.6*t}}function n(t,e,s,h,n=0,a=1){const o=document.createElement("canvas");s*=1.1,h*=1.1,o.width=s,o.height=h;const r=o.getContext("2d");let l;return l=r.createLinearGradient(0,0,s,h),l.addColorStop(n,t),l.addColorStop(a,e),r.fillStyle=l,r.fillRect(0,0,s,h),i.Texture.from(o)}window.__GLSDK_SETUP__&&window.__GLSDK_SETUP__({name:"crash",version:"1.0.0"},h),t.CrashGame=h}({},window.__PIXIV7__);
